<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samfunds Simulator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="game-container">
        <!-- Menu integreret direkte -->
        <header>
            <h1>ğŸ›ï¸ Samfunds Simulator</h1>
            <div class="resources">
                <div class="resource">
                    <span class="resource-label">ğŸ’° Penge</span>
                    <span id="money">10000</span> kr
                </div>
                <div class="resource">
                    <span class="resource-label">ğŸ‘¥ Befolkning</span>
                    <span id="population">0</span> borgere
                </div>
                <div class="resource">
                    <span class="resource-label">ğŸ˜Š Tilfredshed</span>
                    <span id="happiness">75</span>%
                </div>
                <div class="resource">
                    <span class="resource-label">ğŸ’ª Stamina</span>
                    <span id="stamina">10</span>
                </div>
                <div class="resource">
                    <span class="resource-label">ğŸ“… Ã…r</span>
                    <span id="year">1930</span>
                </div>
            </div>
            
            <div class="navigation">
                <button class="nav-btn active" onclick="loadPage('game')">ğŸ® Spil</button>
                <button class="nav-btn" onclick="loadPage('research')">ğŸ”¬ Forskning</button>
                <button class="nav-btn" onclick="loadPage('towns')">ğŸ™ï¸ Byer</button>
                <button class="nav-btn" onclick="loadPage('events')">ğŸ“° Events</button>
                <button class="nav-btn" onclick="loadPage('stats')">ğŸ“Š Statistik</button>
                <button class="nav-btn" onclick="loadPage('settings')">âš™ï¸ Indstillinger</button>
            </div>
        </header>
        
        <!-- Hovedindhold med game.html som standard -->
        <main class="main-content">
            <div id="page-content">
                <!-- Game content bliver indlÃ¦st her -->
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script>
        // Initialiser gameState fÃ¸rst for at sikre det er tilgÃ¦ngeligt
        window.gameState = {
            money: 10000,
            population: 0,
            happiness: 75,
            stamina: 10,
            year: 1930,
            buildings: {},
            maxBuildingSlots: 6,
            research: {
                cityExpansion: false
            }
        };
    </script>
    <script src="gamedata.js"></script>
    <script src="stats.js"></script>
    <script src="research.js"></script>
    <script src="towns.js"></script>
    <script src="population.js"></script>
    <script src="events.js"></script>
    <script src="buildings-grid.js"></script>
    <script src="settings.js"></script>
    <script src="game-logic.js"></script>
    
    <script>
        // Simpel navigation uden menu-load-pages.js
        let currentPage = 'game';
        
        async function loadPage(pageName) {
            try {
                let html;
                
                // For research siden, prÃ¸v at loade research.html fÃ¸rst
                if (pageName === 'research') {
                    if (window.location.protocol !== 'file:') {
                        try {
                            const response = await fetch('research.html');
                            if (response.ok) {
                                html = await response.text();
                                // Clean up HTML for embedding
                                html = html.replace(/<html[^>]*>|<\/html>/gi, '');
                                html = html.replace(/<head[^>]*>[\s\S]*?<\/head>/gi, '');
                                html = html.replace(/<body[^>]*>|<\/body>/gi, '');
                                html = html.replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '');
                                
                                document.getElementById('page-content').innerHTML = html;
                            } else {
                                loadPageFallback(pageName);
                            }
                        } catch (error) {
                            loadPageFallback(pageName);
                        }
                    } else {
                        // For file:// protocol, brug en embedded version af research content
                        loadResearchContent();
                    }
                } else {
                    // For andre sider, prÃ¸v fetch hvis muligt, ellers fallback
                    if (window.location.protocol !== 'file:') {
                        try {
                            const response = await fetch(`${pageName}.html`);
                            if (response.ok) {
                                html = await response.text();
                                // Clean up HTML for embedding
                                html = html.replace(/<html[^>]*>|<\/html>/gi, '');
                                html = html.replace(/<head[^>]*>[\s\S]*?<\/head>/gi, '');
                                html = html.replace(/<body[^>]*>|<\/body>/gi, '');
                                html = html.replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '');
                                
                                document.getElementById('page-content').innerHTML = html;
                            } else {
                                loadPageFallback(pageName);
                            }
                        } catch (error) {
                            loadPageFallback(pageName);
                        }
                    } else {
                        // File protocol fallback
                        loadPageFallback(pageName);
                    }
                }
                
                currentPage = pageName;
                
                // Clean up any page-specific intervals
                if (typeof researchUpdateInterval !== 'undefined') {
                    clearInterval(researchUpdateInterval);
                }
                
                // Opdater aktiv menu-knap
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[onclick="loadPage('${pageName}')"]`).classList.add('active');
                
                // KÃ¸r side-specifik initialisering
                initializePage(pageName);
            } catch (error) {
                console.error(`Failed to load page ${pageName}:`, error);
                loadPageFallback(pageName);
            }
        }
        
        function loadResearchContent() {
            // Embed research content directly for file:// protocol
            const contentContainer = document.getElementById('page-content');
            contentContainer.innerHTML = `
                <div class="research-container">
                    <div class="research-header">
                        <h1>ğŸ”¬ Forskning</h1>
                        <p>Udvikl dit samfund gennem forskning og innovation</p>
                    </div>

                    <div class="research-info">
                        <div class="info-card">
                            <h3>ğŸ§ª Forskningspoint</h3>
                            <div class="info-value" id="research-points">0</div>
                            <p><small>1 per 10 indbyggere + 5 per skole</small></p>
                        </div>
                        <div class="info-card">
                            <h3>ğŸ¯ NuvÃ¦rende Tier</h3>
                            <div class="info-value" id="current-tier">0</div>
                        </div>
                    </div>

                    <div class="research-tiers">
                        <!-- Tier 0 -->
                        <div class="tier-section unlocked" id="tier-0">
                            <div class="tier-status unlocked">âœ… UlÃ¥st</div>
                            <h3>ğŸ˜ï¸ Tier 0: GrundlÃ¦ggende Samfund</h3>
                            <div class="tier-description">
                                <p>De mest basale bygninger til at starte dit samfund</p>
                                <p><strong>Krav:</strong> Ingen - automatisk ulÃ¥st</p>
                            </div>
                            <div class="tier-unlocks">
                                <span class="unlock-item">ğŸ—ï¸ GrundlÃ¦ggende bygninger</span>
                            </div>
                        </div>

                        <!-- Tier 1 -->
                        <div class="tier-section" id="tier-1">
                            <div class="tier-status locked" id="tier-1-status">ğŸ”’ LÃ¥st</div>
                            <h3>ğŸ“ Tier 1: Byudvikling</h3>
                            <div class="tier-description">
                                <p>LÃ¦r at udvide din by med flere byggepladser</p>
                                <p><strong>Krav:</strong> GrundlÃ¦ggende samfund</p>
                                <p><strong>Kost:</strong> 5000 kr</p>
                            </div>
                            <div class="tier-unlocks">
                                <span class="unlock-item">ğŸ—ï¸ Byudvidelse</span>
                            </div>
                            <button class="research-btn" id="research-tier-1" onclick="researchTier(1)" disabled>
                                ï¿½ Forsk Tier 1 (5000 kr)
                            </button>
                        </div>

                        <!-- Tier 2 -->
                        <div class="tier-section" id="tier-2">
                            <div class="tier-status locked" id="tier-2-status">ğŸ”’ LÃ¥st</div>
                            <h3>ğŸ˜ï¸ Tier 2: Bysammenslutning</h3>
                            <div class="tier-description">
                                <p>LÃ¦r at bygge stÃ¸rre bebyggelser og merge eksisterende bygninger</p>
                                <p><strong>Krav:</strong> 100 forskningspoint og Tier 1 ulÃ¥st</p>
                                <p><strong>Kost:</strong> 100 forskningspoint</p>
                            </div>
                            <div class="tier-unlocks">
                                <span class="unlock-item">ğŸ˜ï¸ FlÃ¦kke bygning</span>
                                <span class="unlock-item">ğŸ”„ Merge bygninger</span>
                                <span class="unlock-item">ğŸ›¡ï¸ Event beskyttelse</span>
                            </div>
                            <button class="research-btn" id="research-tier-2" onclick="researchTier(2)" disabled>
                                ğŸ”¬ Forsk Tier 2 (100 point)
                            </button>
                        </div>
                    </div>

                    <div class="research-history">
                        <h3>ğŸ“š Forskningshistorie</h3>
                        <div id="research-history-list">
                            <p><em>Ingen forskning gennemfÃ¸rt endnu</em></p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Research functions for embedded content
        function researchTier(tier) {
            if (researchSystem.researchTier(tier)) {
                updateResearchUI();
                alert(`ğŸ‰ Tier ${tier} forskning fuldfÃ¸rt!\nNye funktioner er nu tilgÃ¦ngelige.`);
                
                // Opdater expansion panel hvis det er tier 1
                if (tier === 1 && typeof updateExpansionPanel === 'function') {
                    updateExpansionPanel();
                }
                // Opdater tier UI hvis det er tier 2  
                if (tier === 2 && typeof updateTierUI === 'function') {
                    updateTierUI();
                }
            } else {
                alert('Du kan ikke forske denne tier endnu. Tjek kravene.');
            }
        }

        function updateResearchUI() {
            if (currentPage !== 'research') return;
            
            const researchPoints = researchSystem.getResearchPoints();
            const currentTier = researchSystem.researchData.currentTier;
            
            // Opdater info cards
            const researchPointsElement = document.getElementById('research-points');
            const currentTierElement = document.getElementById('current-tier');
            
            if (researchPointsElement) researchPointsElement.textContent = researchPoints;
            if (currentTierElement) currentTierElement.textContent = currentTier;
            
            // Opdater Tier 1 status
            const tier1Section = document.getElementById('tier-1');
            const tier1Status = document.getElementById('tier-1-status');
            const tier1Button = document.getElementById('research-tier-1');
            
            if (tier1Section && tier1Status && tier1Button) {
                if (researchSystem.isTierUnlocked(1)) {
                    tier1Section.classList.add('unlocked');
                    tier1Status.textContent = 'âœ… UlÃ¥st';
                    tier1Status.className = 'tier-status unlocked';
                    tier1Button.style.display = 'none';
                } else if (researchSystem.canResearchTier(1)) {
                    tier1Status.textContent = 'ï¿½ Kan kÃ¸bes';
                    tier1Status.className = 'tier-status available';
                    tier1Button.disabled = false;
                } else {
                    tier1Status.textContent = 'ğŸ”’ LÃ¥st (Mangler penge)';
                    tier1Status.className = 'tier-status locked';
                    tier1Button.disabled = true;
                }
            }
            
            // Opdater Tier 2 status
            const tier2Section = document.getElementById('tier-2');
            const tier2Status = document.getElementById('tier-2-status');
            const tier2Button = document.getElementById('research-tier-2');
            
            if (tier2Section && tier2Status && tier2Button) {
                if (researchSystem.isTierUnlocked(2)) {
                    tier2Section.classList.add('unlocked');
                    tier2Status.textContent = 'âœ… UlÃ¥st';
                    tier2Status.className = 'tier-status unlocked';
                    tier2Button.style.display = 'none';
                } else if (researchSystem.canResearchTier(2)) {
                    tier2Status.textContent = 'ğŸ”¬ Kan forskes';
                    tier2Status.className = 'tier-status available';
                    tier2Button.disabled = false;
                } else {
                    tier2Status.textContent = 'ğŸ”’ LÃ¥st (Mangler forskningspoint)';
                    tier2Status.className = 'tier-status locked';
                    tier2Button.disabled = true;
                }
            }
            
            // Opdater forskningshistorie
            updateResearchHistory();
        }

        function updateResearchHistory() {
            const historyList = document.getElementById('research-history-list');
            if (!historyList) return;
            
            const history = researchSystem.researchData.researchHistory;
            
            if (history.length === 0) {
                historyList.innerHTML = '<p><em>Ingen forskning gennemfÃ¸rt endnu</em></p>';
                return;
            }
            
            let html = '';
            history.forEach(entry => {
                const date = new Date(entry.timestamp).toLocaleDateString('da-DK');
                html += `
                    <div class="research-entry">
                        <strong>Tier ${entry.tier}: ${entry.name}</strong>
                        <small>${date}</small>
                    </div>
                `;
            });
            
            historyList.innerHTML = html;
        }

        function loadPageFallback(pageName) {
            const contentContainer = document.getElementById('page-content');
            let html = '';
            
            switch(pageName) {
                case 'game':
                    html = getGameHTML();
                    break;
                case 'research':
                    html = getResearchHTML();
                    break;
                case 'towns':
                    html = getTownsHTML();
                    break;
                case 'events':
                    html = getEventsHTML();
                    break;
                case 'stats':
                    html = getStatsHTML();
                    break;
                case 'settings':
                    html = getSettingsHTML();
                    break;
                default:
                    html = '<div>Siden blev ikke fundet</div>';
            }
            
            contentContainer.innerHTML = html;
        }
        
        function initializePage(pageName) {
            switch(pageName) {
                case 'game':
                    if (typeof initializeGame === 'function') {
                        initializeGame();
                    }
                    break;
                case 'towns':
                    if (typeof initializeTowns === 'function') {
                        initializeTowns();
                    }
                    break;
                case 'events':
                    if (typeof initializeEvents === 'function') {
                        initializeEvents();
                    }
                    break;
                case 'stats':
                    if (typeof initializeStats === 'function') {
                        initializeStats();
                    }
                    break;
                case 'research':
                    // Initialize research UI
                    setTimeout(() => {
                        updateResearchUI();
                        // Also set up an interval to update research points every 5 seconds
                        if (typeof researchUpdateInterval !== 'undefined') {
                            clearInterval(researchUpdateInterval);
                        }
                        researchUpdateInterval = setInterval(updateResearchUI, 5000);
                    }, 100);
                    break;
                case 'settings':
                    if (typeof initializeSettings === 'function') {
                        initializeSettings();
                    }
                    break;
            }
        }
        
        function getGameHTML() {
            return `
                <div class="city-view">
                    <h2>Dit Land</h2>
                    
                    <div class="buildings-grid">
                        <div class="building-slot" id="slot-1">
                            <div class="empty-slot">Tom grund<br>Klik for at bygge</div>
                        </div>
                        <div class="building-slot" id="slot-2">
                            <div class="empty-slot">Tom grund<br>Klik for at bygge</div>
                        </div>
                        <div class="building-slot" id="slot-3">
                            <div class="empty-slot">Tom grund<br>Klik for at bygge</div>
                        </div>
                        <div class="building-slot" id="slot-4">
                            <div class="empty-slot">Tom grund<br>Klik for at bygge</div>
                        </div>
                        <div class="building-slot" id="slot-5">
                            <div class="empty-slot">Tom grund<br>Klik for at bygge</div>
                        </div>
                        <div class="building-slot" id="slot-6">
                            <div class="empty-slot">Tom grund<br>Klik for at bygge</div>
                        </div>
                        <div class="building-slot" id="slot-7" style="display: none;">
                            <div class="empty-slot">Tom grund<br>Klik for at bygge</div>
                        </div>
                        <div class="building-slot" id="slot-8" style="display: none;">
                            <div class="empty-slot">Tom grund<br>Klik for at bygge</div>
                        </div>
                        <div class="building-slot" id="slot-9" style="display: none;">
                            <div class="empty-slot">Tom grund<br>Klik for at bygge</div>
                        </div>
                        <div class="building-slot" id="slot-10" style="display: none;">
                            <div class="empty-slot">Tom grund<br>Klik for at bygge</div>
                        </div>
                        <div class="building-slot" id="slot-11" style="display: none;">
                            <div class="empty-slot">Tom grund<br>Klik for at bygge</div>
                        </div>
                        <div class="building-slot" id="slot-12" style="display: none;">
                            <div class="empty-slot">Tom grund<br>Klik for at bygge</div>
                        </div>
                    </div>
                </div>

                <div class="sidebar">
                    <div class="actions-panel">
                        <h3>ğŸ—ï¸ Byg</h3>
                        <button class="build-btn" onclick="selectBuilding('road')">
                            ğŸ›£ï¸ Vej (100 kr, 1 ğŸ’ª)<br>
                            <small>Grundlag for andre bygninger</small>
                        </button>
                        <button class="build-btn" onclick="selectBuilding('house')">
                            ğŸ  Lille FlÃ¦kke (500 kr, 2 ğŸ’ª)<br>
                            <small>+12 befolkning (krÃ¦ver vej)</small>
                        </button>
                        <button class="build-btn" onclick="selectBuilding('powerplant')">
                            âš¡ KraftvÃ¦rk (2000 kr, 3 ğŸ’ª)<br>
                            <small>Giver strÃ¸m (krÃ¦ver vej)</small>
                        </button>
                        <button class="build-btn" onclick="selectBuilding('hospital')">
                            ğŸ¥ Hospital (3000 kr, 4 ğŸ’ª)<br>
                            <small>Forbedrer sundhed (krÃ¦ver vej)</small>
                        </button>
                        <button class="build-btn" onclick="selectBuilding('school')">
                            ğŸ« Skole (1500 kr, 3 ğŸ’ª)<br>
                            <small>Giver uddannelse (krÃ¦ver vej)</small>
                        </button>
                        <button class="build-btn tier-2-building" id="town-btn" onclick="selectBuilding('town')" style="display: none;">
                            ğŸ˜ï¸ FlÃ¦kke (1000 kr, 3 ğŸ’ª)<br>
                            <small>+17 befolkning, mindre negative events</small>
                        </button>
                    </div>

                    <div class="merge-panel" id="merge-panel" style="display: none;">
                        <h3>ğŸ”„ Merge Bygninger</h3>
                        <button class="merge-btn" onclick="showMergeOptions()">
                            ğŸ”„ Merge 3 Lille FlÃ¦kke â†’ 1 FlÃ¦kke<br>
                            <small>Gratis upgrade til stÃ¸rre bygning</small>
                        </button>
                    </div>

                    <div class="status-panel">
                        <h3>ğŸ“Š Status</h3>
                        <div class="status-item">
                            <span>ğŸ›£ï¸ Veje:</span>
                            <span id="road-status" class="status-bad">Ingen</span>
                        </div>
                        <div class="status-item">
                            <span>âš¡ StrÃ¸m:</span>
                            <span id="power-status" class="status-bad">Ingen</span>
                        </div>
                        <div class="status-item">
                            <span>ğŸ¥ Sundhed:</span>
                            <span id="health-status" class="status-bad">DÃ¥rlig</span>
                        </div>
                        <div class="status-item">
                            <span>ğŸ“š Uddannelse:</span>
                            <span id="education-status" class="status-bad">Ingen</span>
                        </div>
                        <div class="status-item">
                            <span>ğŸ  Boliger:</span>
                            <span id="housing-status" class="status-bad">FÃ¥</span>
                        </div>
                    </div>

                    <div class="economy-panel">
                        <h3>ğŸ’° Ã˜konomi</h3>
                        <div class="status-item">
                            <span>Ã…rlig indtÃ¦gt:</span>
                            <span id="annual-income" class="status-neutral">0 kr</span>
                        </div>
                        <div class="status-item">
                            <span>Ã…rlige udgifter:</span>
                            <span id="annual-expenses" class="status-neutral">0 kr</span>
                        </div>
                        <div class="status-item">
                            <span>Netto resultat:</span>
                            <span id="net-result" class="status-neutral">0 kr</span>
                        </div>
                        <button class="build-btn" onclick="nextTurn()" style="margin-top: 10px;">
                            ğŸ“… NÃ¦ste Ã…r
                        </button>
                    </div>
                    
                    <div class="expansion-panel" id="expansion-panel" style="display: none;">
                        <h3>ğŸ“ Byudvidelse</h3>
                        <p>KÃ¸b ekstra byggepladser til din by</p>
                        <p id="slots-info" style="font-size: 0.9em; color: #666; margin-bottom: 10px;">Du har 6 af 12 mulige byggepladser</p>
                        <button class="build-btn" onclick="expandCity()" id="expand-btn">
                            ğŸ—ï¸ KÃ¸b byggeplads (5.000 kr)
                        </button>
                        <p><small>KrÃ¦ver Tier 1 forskning</small></p>
                    </div>
                </div>
                
                <!-- Byggemenu modal -->
                <div id="building-menu" class="modal" style="display: none;">
                    <div class="modal-content">
                        <h3>ğŸ—ï¸ VÃ¦lg bygning</h3>
                        <div class="building-options">
                            <button class="build-option" onclick="buildBuilding('road', document.getElementById('building-menu').dataset.slotId)">
                                ğŸ›£ï¸ Vej<br>
                                <small>100 kr, 1 ğŸ’ª</small>
                            </button>
                            <button class="build-option" onclick="buildBuilding('house', document.getElementById('building-menu').dataset.slotId)">
                                ğŸ  Lille FlÃ¦kke<br>
                                <small>500 kr, 2 ğŸ’ª</small>
                            </button>
                            <button class="build-option" onclick="buildBuilding('powerplant', document.getElementById('building-menu').dataset.slotId)">
                                âš¡ KraftvÃ¦rk<br>
                                <small>2000 kr, 3 ğŸ’ª</small>
                            </button>
                            <button class="build-option" onclick="buildBuilding('hospital', document.getElementById('building-menu').dataset.slotId)">
                                ğŸ¥ Hospital<br>
                                <small>3000 kr, 4 ğŸ’ª</small>
                            </button>
                            <button class="build-option" onclick="buildBuilding('school', document.getElementById('building-menu').dataset.slotId)">
                                ğŸ« Skole<br>
                                <small>1500 kr, 3 ğŸ’ª</small>
                            </button>
                            <button class="build-option tier-2-building" id="town-menu-btn" onclick="buildBuilding('town', document.getElementById('building-menu').dataset.slotId)" style="display: none;">
                                ğŸ˜ï¸ FlÃ¦kke<br>
                                <small>1000 kr, 3 ğŸ’ª</small>
                            </button>
                        </div>
                        <button class="close-btn" onclick="hideBuildingMenu()">Luk</button>
                    </div>
                </div>
            `;
        }
        
        function getResearchHTML() {
            // Fallback hvis loadResearchContent ikke virker
            return `
                <div class="research-fallback">
                    <h2>ğŸ”¬ Forskning</h2>
                    <p>IndlÃ¦ser forskningssiden...</p>
                    <p><small>Hvis denne besked forbliver synlig, prÃ¸v at genindlÃ¦se siden.</small></p>
                    <button onclick="location.reload()">ğŸ”„ GenindlÃ¦s</button>
                    <button onclick="loadResearchContent()">ğŸ”¬ IndlÃ¦s forskning</button>
                </div>
            `;
        }
        
        function getTownsHTML() {
            return `
                <div class="towns-container">
                    <h2>ğŸ™ï¸ Byudvidelse</h2>
                    
                    <div class="expansion-info">
                        <h3>ğŸ“Š Byoversigt</h3>
                        <div class="status-item">
                            <span>NuvÃ¦rende byggepladser:</span>
                            <span id="current-slots">6</span>
                        </div>
                        <div class="status-item">
                            <span>Maksimale byggepladser:</span>
                            <span id="max-slots">12</span>
                        </div>
                        <div class="status-item">
                            <span>Ledige pladser:</span>
                            <span id="available-slots">6</span>
                        </div>
                    </div>
                    
                    <div class="expansion-actions">
                        <h3>ğŸ—ï¸ Byggeplads Oversigt</h3>
                        <p>Oversigt over dine tilgÃ¦ngelige byggepladser.</p>
                        <p><strong>BemÃ¦rk:</strong> Brug hovedspillet til at kÃ¸be nye pladser</p>
                        
                        <div class="expansion-grid">
                            <div class="expansion-slot" id="slot-7">
                                <div class="slot-number">Plads 7</div>
                                <div class="slot-status" id="status-7">ğŸ”’ LÃ¥st</div>
                            </div>
                            <div class="expansion-slot" id="slot-8">
                                <div class="slot-number">Plads 8</div>
                                <div class="slot-status" id="status-8">ğŸ”’ LÃ¥st</div>
                            </div>
                            <div class="expansion-slot" id="slot-9">
                                <div class="slot-number">Plads 9</div>
                                <div class="slot-status" id="status-9">ğŸ”’ LÃ¥st</div>
                            </div>
                            <div class="expansion-slot" id="slot-10">
                                <div class="slot-number">Plads 10</div>
                                <div class="slot-status" id="status-10">ğŸ”’ LÃ¥st</div>
                            </div>
                            <div class="expansion-slot" id="slot-11">
                                <div class="slot-number">Plads 11</div>
                                <div class="slot-status" id="status-11">ğŸ”’ LÃ¥st</div>
                            </div>
                            <div class="expansion-slot" id="slot-12">
                                <div class="slot-number">Plads 12</div>
                                <div class="slot-status" id="status-12">ğŸ”’ LÃ¥st</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getStatsHTML() {
            return `
                <div class="stats-container">
                    <h2>ğŸ“Š Statistik</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>ğŸ’° Ã˜konomi</h3>
                            <div class="stat-item">
                                <span>NuvÃ¦rende penge:</span>
                                <span id="stat-money">10.000 kr</span>
                            </div>
                            <div class="stat-item">
                                <span>Ã…rlig indtÃ¦gt:</span>
                                <span id="stat-income">0 kr</span>
                            </div>
                            <div class="stat-item">
                                <span>Ã…rlige udgifter:</span>
                                <span id="stat-expenses">0 kr</span>
                            </div>
                            <div class="stat-item">
                                <span>Befolkningsbonus:</span>
                                <span id="stat-population-bonus">0 kr</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <h3>ğŸ‘¥ Befolkning</h3>
                            <div class="stat-item">
                                <span>NuvÃ¦rende befolkning:</span>
                                <span id="stat-population">0</span>
                            </div>
                            <div class="stat-item">
                                <span>Tilfredshed:</span>
                                <span id="stat-happiness">75%</span>
                            </div>
                            <div class="stat-item">
                                <span>Boliger:</span>
                                <span id="stat-houses">0</span>
                            </div>
                            <button class="build-btn" onclick="showPopulationDetails()" style="margin-top: 10px;">
                                ğŸ“‹ Befolknings-detaljer
                            </button>
                        </div>
                        
                        <div class="stat-card">
                            <h3>ğŸ—ï¸ Bygninger</h3>
                            <div class="stat-item">
                                <span>Veje:</span>
                                <span id="stat-roads">0</span>
                            </div>
                            <div class="stat-item">
                                <span>KraftvÃ¦rker:</span>
                                <span id="stat-powerplants">0</span>
                            </div>
                            <div class="stat-item">
                                <span>Hospitaler:</span>
                                <span id="stat-hospitals">0</span>
                            </div>
                            <div class="stat-item">
                                <span>Skoler:</span>
                                <span id="stat-schools">0</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <h3>ğŸ”¬ Forskning</h3>
                            <div class="stat-item">
                                <span>Byudvidelse:</span>
                                <span id="stat-expansion">âŒ Ikke forsket</span>
                            </div>
                            <div class="stat-item">
                                <span>Byggepladser:</span>
                                <span id="stat-slots">6/12</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getSettingsHTML() {
            return `
                <div class="settings-container">
                    <h2>âš™ï¸ Indstillinger</h2>
                    
                    <div class="settings-panel">
                        <div class="settings-group">
                            <h3>ğŸ® Spil</h3>
                            <label for="autosave">Automatisk gemning:</label>
                            <input type="checkbox" id="autosave" checked>
                            
                            <label for="speed">Spil hastighed:</label>
                            <select id="speed">
                                <option value="slow">Langsom</option>
                                <option value="normal" selected>Normal</option>
                                <option value="fast">Hurtig</option>
                            </select>
                        </div>
                        
                        <div class="settings-group">
                            <h3>ğŸ’¾ Data</h3>
                            <button onclick="saveGameData()">ğŸ’¾ Gem spil</button>
                            <button onclick="loadGameData()">ğŸ“ IndlÃ¦s spil</button>
                            <button onclick="exportGameData()">ğŸ“¤ Eksporter data</button>
                            <button onclick="importGameData()">ğŸ“¥ Importer data</button>
                            <button onclick="resetGame()" class="danger">ğŸ”„ Nulstil spil</button>
                        </div>
                        
                        <div class="settings-group">
                            <h3>ğŸ”§ Debug</h3>
                            <button onclick="clearCache()">ğŸ—‘ï¸ Ryd cache</button>
                            <button onclick="showDebugInfo()">ğŸ› Debug info</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getEventsHTML() {
            return `
                <div class="events-container">
                    <h2>ğŸ“° Events Historik</h2>
                    
                    <div class="events-header">
                        <h3>ğŸ“Š Event Statistikker</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h4>ğŸ“ˆ Totalt</h4>
                                <div class="stat-value" id="total-events">0</div>
                                <div class="stat-label">Events</div>
                            </div>
                            <div class="stat-card">
                                <h4>âœ… Positive</h4>
                                <div class="stat-value" id="positive-events">0</div>
                                <div class="stat-label">Gode Events</div>
                            </div>
                            <div class="stat-card">
                                <h4>âŒ Negative</h4>
                                <div class="stat-value" id="negative-events">0</div>
                                <div class="stat-label">DÃ¥rlige Events</div>
                            </div>
                        </div>
                    </div>

                    <div class="events-controls">
                        <h3>ğŸ” Filtrer Events</h3>
                        <div class="filter-controls">
                            <label>
                                <input type="checkbox" id="show-positive" checked> 
                                âœ… Positive Events
                            </label>
                            <label>
                                <input type="checkbox" id="show-negative" checked> 
                                âŒ Negative Events
                            </label>
                            <label>
                                Vis sidste: 
                                <select id="years-filter">
                                    <option value="5">5 Ã¥r</option>
                                    <option value="10" selected>10 Ã¥r</option>
                                    <option value="20">20 Ã¥r</option>
                                    <option value="50">50 Ã¥r</option>
                                    <option value="100">Alle</option>
                                </select>
                            </label>
                            <button onclick="updateEventHistory()" class="refresh-btn">ğŸ”„ Opdater</button>
                        </div>
                    </div>

                    <div class="events-timeline">
                        <h3>ğŸ“… Event Historik</h3>
                        <div id="events-list">
                            <div class="no-events">
                                <p>Ingen events endnu...</p>
                                <p><small>Events begynder at ske nÃ¥r du nÃ¥r Tier 1 forskning!</small></p>
                            </div>
                        </div>
                    </div>

                    <div class="events-info">
                        <h3>â„¹ï¸ Om Events</h3>
                        <div class="info-content">
                            <p><strong>Hvordan fungerer events?</strong></p>
                            <ul>
                                <li><strong>Tier 0:</strong> Ingen events kan ske</li>
                                <li><strong>Tier 1:</strong> 0-5 events per Ã¥r (afhÃ¦nger af byens stÃ¸rrelse)</li>
                                <li><strong>Tier 2+:</strong> Flere events bliver tilgÃ¦ngelige</li>
                            </ul>
                            
                            <p><strong>Event Typer (Tier 1):</strong></p>
                            <ul>
                                <li>ğŸ‘¶ <strong>FÃ¸dsler:</strong> Baby boom Ã¸ger befolkning og tilfredshed</li>
                                <li>âš°ï¸ <strong>DÃ¸dsfald:</strong> Naturlige dÃ¸dsfald reducerer befolkning</li>
                                <li>ğŸ¦  <strong>Epidemi:</strong> Sygdom rammer byen (mindre sandsynligt med hospitaler)</li>
                                <li>ğŸ‰ <strong>Festival:</strong> Byfestival Ã¸ger tilfredshed og giver penge</li>
                                <li>ğŸ”¥ <strong>Brand:</strong> Skader byens Ã¸konomi</li>
                            </ul>
                            
                            <p><strong>Tips:</strong></p>
                            <ul>
                                <li>StÃ¸rre byer har flere events</li>
                                <li>HÃ¸j tilfredshed Ã¸ger chancen for positive events</li>
                                <li>Hospitaler reducerer risiko for epidemier</li>
                                <li>Events har cooldown-perioder</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        // IndlÃ¦s game.html som standard nÃ¥r siden loader
        window.addEventListener('DOMContentLoaded', function() {
            loadPage('game');
        });
        
        // Initialiser events-siden
        function initializeEvents() {
            // Opdater efter kort forsinkelse
            setTimeout(() => {
                updateEventStatistics();
                updateEventHistory();
                
                // Setup event listeners
                if (document.getElementById('show-positive')) {
                    document.getElementById('show-positive').addEventListener('change', updateEventHistory);
                }
                if (document.getElementById('show-negative')) {
                    document.getElementById('show-negative').addEventListener('change', updateEventHistory);
                }
                if (document.getElementById('years-filter')) {
                    document.getElementById('years-filter').addEventListener('change', updateEventHistory);
                }
            }, 100);
        }

        // Opdater event historik
        function updateEventHistory() {
            if (!window.eventManager) {
                console.log('Event manager not ready');
                return;
            }
            
            const yearsFilter = document.getElementById('years-filter') ? parseInt(document.getElementById('years-filter').value) : 10;
            const showPositive = document.getElementById('show-positive') ? document.getElementById('show-positive').checked : true;
            const showNegative = document.getElementById('show-negative') ? document.getElementById('show-negative').checked : true;
            
            let events = window.eventManager.getEventHistory(yearsFilter);
            
            // Filtrer efter type
            events = events.filter(event => {
                if (event.type === 'positive' && !showPositive) return false;
                if (event.type === 'negative' && !showNegative) return false;
                return true;
            });
            
            const eventsList = document.getElementById('events-list');
            if (!eventsList) return;
            
            if (events.length === 0) {
                eventsList.innerHTML = `
                    <div class="no-events">
                        <p>Ingen events matcher dine filtre...</p>
                        <p><small>PrÃ¸v at justere filtrene eller spil videre for at opleve events!</small></p>
                    </div>
                `;
                return;
            }
            
            // Sorter efter Ã¥r (nyeste fÃ¸rst)
            events.sort((a, b) => b.year - a.year);
            
            let html = '';
            events.forEach(event => {
                const typeClass = event.type === 'positive' ? 'positive' : 'negative';
                const typeIcon = event.type === 'positive' ? 'âœ…' : 'âŒ';
                
                html += `
                    <div class="event-item ${typeClass}">
                        <div class="event-header">
                            <span class="event-year">Ã…r ${event.year}</span>
                            <span class="event-type">${typeIcon}</span>
                        </div>
                        <div class="event-title">${event.name}</div>
                        <div class="event-message">${event.message}</div>
                        <div class="event-effects">
                            ${event.effects.population ? `ğŸ‘¥ ${event.effects.population > 0 ? '+' : ''}${event.effects.population} borgere` : ''}
                            ${event.effects.happiness ? `ğŸ˜Š ${event.effects.happiness > 0 ? '+' : ''}${event.effects.happiness}% tilfredshed` : ''}
                            ${event.effects.money ? `ğŸ’° ${event.effects.money > 0 ? '+' : ''}${event.effects.money.toLocaleString()} kr` : ''}
                        </div>
                    </div>
                `;
            });
            
            eventsList.innerHTML = html;
        }
        
        // Opdater event statistikker
        function updateEventStatistics() {
            if (!window.eventManager) {
                return;
            }
            
            const stats = window.eventManager.getEventStatistics();
            
            const totalEventsEl = document.getElementById('total-events');
            const positiveEventsEl = document.getElementById('positive-events');
            const negativeEventsEl = document.getElementById('negative-events');
            
            if (totalEventsEl) totalEventsEl.textContent = stats.totalEvents;
            if (positiveEventsEl) positiveEventsEl.textContent = stats.positiveEvents;
            if (negativeEventsEl) negativeEventsEl.textContent = stats.negativeEvents;
        }
    </script>
</body>
</html>
